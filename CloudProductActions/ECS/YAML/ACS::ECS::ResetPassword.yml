FormatVersion: OOS-2019-06-01
Description:
  name-en: ACS::ECS::ResetPassword
  name-zh-cn: 重置ECS实例密码
  en: Resets password of an ECS instance
  zh-cn: 重置ECS实例密码
Parameters:
  regionId:
    Description:
      en: The ID of region
      zh-cn: 地域ID
    Type: String
    Default: '{{ ACS::RegionId }}'
  instanceId:
    Description:
      en: The ID of ECS instance
      zh-cn: ECS实例ID
    Type: String
    MinLength: 1
    MaxLength: 30
  password:
    Description:
      en: The password of the ECS instance
      zh-cn: ECS实例的密码
    Type: String
Tasks:
- Name: modifyInstanceAttribute
  Action: ACS::ExecuteAPI
  Description:
    en: Resets password of an ECS instance
    zh-cn: 重置ECS实例密码
  Properties:
    Service: ECS
    API: ModifyInstanceAttribute
    Parameters:
      RegionId: '{{ regionId }}'
      InstanceId: '{{ instanceId }}'
      Password: '{{ password }}'
- Name: rebootInstance
  Action: ACS::ExecuteAPI
  Description:
    en: Restarts the ECS instance
    zh-cn: 重启ECS实例
  Properties:
    Service: ECS
    API: RebootInstance
    Parameters:
      RegionId: '{{ regionId }}'
      InstanceId: '{{ instanceId }}'
- Name: untilInstanceReady
  Action: ACS::WaitFor
  Description:
    en: Waits for the ECS instance to enter running status
    zh-cn: 等待ECS实例进入运行状态
  Properties:
    Service: ECS
    API: DescribeInstances
    Parameters:
      RegionId: '{{ regionId }}'
      InstanceIds:
      - '{{ instanceId }}'
    DesiredValues:
    - Running
    PropertySelector: Instances.Instance[].Status
  Outputs:
    instanceIds:
      Type: List
      ValueSelector: Instances.Instance[].InstanceId
Outputs:
  instanceId:
    Type: String
    Value: '{{ instanceId }}'
